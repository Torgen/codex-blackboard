<template name="logistics">
  <div class="bb-logistics">
    <section class="bb-logistics-metas">
    {{#each r in rounds}}
      {{#each m in (metas r)}}
        {{#if m.puzzles}}
          {{>logistics_meta round=r meta=m}}
        {{else}}
          {{> logistics_puzzle m}}
        {{/if}}
      {{/each}}
    {{/each}}
    </section>
    {{> callins_table}}
  </div>
</template>

<template name="logistics_puzzle_presence">
  {{#with presenceForScope "jitsi"}}
    <i class="fas fa-video"><span class="count">{{this}}</span></i>
  {{else with presenceForScope "chat"}}
    <i class="fas fa-comment-alt"><span class="count">{{this}}</span></i>
  {{/with}}
</template>

<template name="logistics_puzzle">
  <a href="/puzzles/{{_id}}" class="puzzle puzzles-link {{#if solved}}solved{{else if stuck this}}stuck{{/if}}"><span class="fill"><span class="puzzle-name">{{name}}</span></span>{{>logistics_puzzle_presence this}}</a>
</template>

<template name="logistics_meta">
  {{#let p=puzzles}}
  <div class="bb-logistics-meta {{#if meta.solved}}solved{{else if stuck this}}stuck{{/if}}" style="background-color: {{color}}; --num-feeders:{{p.length}}">
    <header>
      <div class="round">{{round.name}}</div>
      <a href="/puzzles/{{meta._id}}" class="meta puzzles-link {{#if meta.solved}}solved{{else if stuck this}}stuck{{/if}}"><span class="fill"><span class="puzzle-name">{{meta.name}}</span></span>{{>logistics_puzzle_presence meta}}</a>
    </header>
    <div class="feeders">
      {{#each puzzle in p}}
        {{> logistics_puzzle puzzle}}
      {{/each}}
    </div>
  </div>
  {{/let}}
</template>

<template name="logistics_topright_panel">
  <div class="bb-logistics-info">
    <div class="btn-toolbar">
      {{>onduty_control}}
    </div>
    {{>starred_messages canModify=mynick}}
  </div>
</template>
