<template name="logistics">
  <div class="bb-logistics">
    <section class="bb-logistics-metas">
    {{#each r in rounds}}
      {{#each m in (metas r)}}
        {{>logistics_meta round=r meta=m}}
      {{/each}}
    {{/each}}
    </section>
    {{> callins_table}}
  </div>
</template>

<template name="_logistics_puzzle_presence">
  {{#with presenceForScope "jitsi"}}
    <i class="fas fa-video"><span class="count">{{this}}</span></i>
  {{else with presenceForScope "chat"}}
    <i class="fas fa-comment-alt"><span class="count">{{this}}</span></i>
  {{/with}}
</template>

<template name="logistics_meta">
  {{#let p=puzzles}}
  <div class="bb-logistics-meta {{#if meta.solved}}solved{{else if stuck this}}stuck{{/if}}" style="background-color: {{color}}; --num-feeders:{{p.length}}">
    <header>
      <div class="round">{{round.name}}</div>
      <a href="/puzzles/{{meta._id}}" class="puzzles-link {{class meta}}"><span class="fill"><span class="puzzle-name">{{meta.name}}</span></span>{{>_logistics_puzzle_presence meta}}</a>
    </header>
    <div class="feeders">
      {{#each puzzle in p}}
        <a href="/puzzles/{{puzzle._id}}" class="puzzles-link {{class puzzle}}"><span class="fill"><span class="puzzle-name">{{puzzle.name}}</span></span>{{>_logistics_puzzle_presence puzzle}}</a>
      {{/each}}
    </div>
  </div>
  {{/let}}
</template>

<template name="logistics_topright_panel">
  <div class="bb-logistics-info">
    {{>onduty_control}}
    {{>starred_messages canModify=mynick}}
  </div>
</template>
